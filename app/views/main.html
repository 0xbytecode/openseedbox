<!DOCTYPE html>
<html>
	<head>
		<title>OpenSeedbox - #{get "title" /}</title>
		<link rel="stylesheet" href="#{asset.url '/stylesheets/bootstrap.min.css' /}">
		<link rel="stylesheet" href="#{asset.url '/stylesheets/all.css' /}" />
		<link rel="shortcut icon" href="#{asset.url '/images/favicon.ico' /}" />
		#{get "moreStyles" /}				
		<script src="#{asset.url '/javascripts/jquery.min.js' /}" type="text/javascript"></script>
		<script src="#{asset.url '/javascripts/bootstrap.min.js' /}" type="text/javascript"></script>
		<script src="#{asset.url '/javascripts/jquery-ui.position.min.js' /}" type="text/javascript"></script>
		#{get "moreScripts" /}
	</head>
	<body style="padding-top:70px;">
		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a id="logo" class="brand" href="@{Client.index()}"><img src="#{asset.url '/images/top-logo.png' /}" /></a>
					<ul class="nav">
						#{if (currentUser?.isAdmin())}
							<li  class="#{get "admin_active" /}"><a href="@{Admin.index()}">Admin</a></li>
						#{/if}
					</ul>
					<ul class="nav pull-right">
						#{if (currentUser)}
							<li>
								<img src="${currentUser.avatarUrl}" style="padding-top:12px; height:45px;" />
							</li>
							<li>
								<a href="@{Accounts.plans()}">${currentUser.displayName}</a>
							</li>
							<li><a href="@{Auth.logout()}">Logout</a></li>
						#{/if}
						#{else}
							<li><a href="@{Auth.login()}">Login</a></li>
						#{/else}
					</ul>
				</div>
			</div>
		</div>
		<div id="container" class="container" style="padding-top: 20px;">
			<div id="flash-error" class="alert alert-error #{ifError "general"}#{/ifError}#{else}hide#{/else}">
				<a class="close" data-dismiss="alert" href="#">&times;</a>
				<h3 id="flash-error-heading" class="alert-heading">An error occured:</h3>
				<span id="flash-error-content">
					#{ifError "general"}#{error "general" /}#{/ifError}
				</span>
			</div>
			#{if (flash.warning)}
			<div id="flash-warning" class="alert alert-warning">
				<a class="close" data-dismiss="alert" href="#">&times;</a>
				<h3 id="flash-success-heading" class="alert-heading">Warning</h3>
				<span id="flash-message-content">
					${flash.warning}
				</span>
			</div>				
			#{/if}
			#{if (flash.message)}
			<div id="flash-message" class="alert alert-success">
				<a class="close" data-dismiss="alert" href="#">&times;</a>
				<h3 id="flash-success-heading" class="alert-heading">Success:</h3>
				<span id="flash-message-content">
					${flash.message}
				</span>
			</div>
			#{/if}
			#{if (currentUser)}			
				%{ def messages = currentUser.getUnreadMessages(); %}
				#{list items:messages, as:"message"}
				<div class="user-message alert #{if (message.state == models.UserMessage.State.MESSAGE)}alert-success#{/if}#{else}alert-error#{/else}">
					<a class="close" data-dismiss="alert" href="#" data-alert-id="${message.id}">&times;</a>
					<h3 class="alert-heading">${message.heading}</h3>
					<span>${message.message.raw()}</span>
					[<a class="close-link" href="#" data-dismiss="alert" data-alert-id="${message.id}">Dismiss</a>]
				</div>
				#{/list}
			#{/if}		
			<div class="clearfix"></div>
			#{doLayout /}
		</div>
		<script type="text/javascript">
			(function($) {
				$(document).ready(function() {
					$(".user-message a.close, .user-message a.close-link").click(function() {
						var id = $(this).data("alert-id");
						$.post("@{Client.dismissMessage}?messageId=" + id);
					})
				});
			})(jQuery);
		</script>
		#{if mode != "dev"}
			<script type="text/javascript">
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-32647401-2']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
		#{/if}
		</script>		
	</body>
</html>
