#{extends "main.html" /}
#{set title: "Seedbox" /}
#{set torrents_active: "active" /}
#{set "moreScripts"}
	<script type="text/javascript" src="#{asset.url '/javascripts/client.js' /}"></script>
	<script type="text/javascript" src="#{asset.url '/javascripts/ajax-typeahead.min.js' /}"></script>
#{/set}
#{set "moreStyles"}
	<link rel="stylesheet" type="text/css" href="#{asset.url '/stylesheets/client.css' /}" />
#{/set}

#{choose-account-dropdown user:currentUser, account:activeAccount, returnTo:"/client", what:"torrents" /}

<div id="tab-header">
	<br />
	<ul class="nav nav-tabs">
		<li class="active"><a href="#"><img src="#{asset.ajax /}" /> Loading tabs...</a></li>
	</ul>
</div>
<div class="pull-right" style="margin-top: -50px;">
	<img id="global-loader" src="#{asset.ajax /}" />
	<a href="#add-torrent-dialog" class="btn btn-success add-torrent" data-toggle="modal"><i class="icon-plus"></i>Add Torrent</a>
</div>
<div id="user-stats" class="pull-right">
	
</div>
<div id="with-selected" class="btn-group">
	<a href="#" class="btn dropdown-toggle" data-toggle="dropdown">With selected: <span class="caret"></span></a>
	<ul id="group-actions" class="dropdown-menu">
		<li><a href="#" class="group-actions-start">Start</a></li>
		<li><a href="#" class="group-actions-pause">Pause</a></li>
		<li><a href="#" class="group-actions-remove">Remove</a></li>
		<li><a href="#" class="group-actions-add-group">Add group</a></li>
	</ul>
	<img id="group-actions-loader" class="hide" src="#{asset.ajax /}" style="margin-left: 10px;"/>
</div>
<div class="clearfix"></div>
<div id="torrent-list" class="tab-content">
	
</div>
<div class="modal hide" id="add-torrent-dialog">
	<form class="form-horizontal" enctype="multipart/form-data" method="post" action="@{Client.addTorrent}">
	<div class="modal-header">
		<a class="close" data-dismiss="modal">&times;</a>
		<h2>Add Torrent</h2>
	</div>
	<div class="modal-body">
		#{set "ajax_url"}
			#{asset.ajax /}
		#{/set}
		#{form.text label:"Search Isohunt:", name:"search", placeholder:"Enter search terms", extra:"<a id='clear' class='btn' href='#'>Clear</a><img class='hide' id='search-loader' src='${ajax_url.trim()}' />" /}
		#{form.text label:"URL or Magnet:", name:"urlOrMagnet", placeholder:"Paste torrent URL or Magnet link" /}
		#{form.upload label:"Upload from computer:", name:"fileFromComputer" /}
	</div>
	<div class="modal-footer">
		<input type="submit" class="btn btn-primary" value="Add Torrent" />
		<a href="#" class="btn" data-dismiss="modal">Close</a>
	</div>	
	</form>
</div>
<div class="modal hide" id="remove-torrent-dialog">
	<div class="modal-header">
		<a class="close" data-dismiss="modal">&times;</a>
		<h2>Remove Torrent</h2>
	</div>	
	<div class="modal-body">
		<p>Are you sure you want to remove <strong class="torrent-name"></strong> (including all files)?</p>
	</div>
	<div class="modal-footer">
		<a id="remove-torrent-button" class="btn btn-danger" href="#">Remove</a>
		<a href="#" class="btn" data-dismiss="modal">Close</a>
	</div>
	<script type="text/javascript">
		(function($) {
			$(document).ready(function() {
				$("#remove-torrent-button").click(function() {
					var hash = $(this).data("torrent-hash");
					$.post("/client/removeTorrent?ext=json", {
						"torrentHash" : hash
					}, function() {
						$("#t_" + hash).fadeOut("slow", function() {
							$(this).remove();
						});
						$("#remove-torrent-dialog").modal("hide");
						window.refresh_disabled = false;
					});
					return false;
				});
				
				$("#search").typeahead({
					"ajax" : {
						"url" : "@{Client.searchIsohunt}",
						"displayField" : "label",
						"preDispatch" : function(query) {
							$("#search-loader").show();
							return {
								"query" : query
							}
						},
						"preProcess" : function(data) {
							$("#search-loader").hide();
							return data;
						}
					},
					"matcher" : function() { return true; },
					"display" : "label",
					"val" : "torrent_url",
					"itemSelected" : function(item, val, text) {
						$("#urlOrMagnet").val(val);
					}
				});
				
				$("#clear").click(function() {
					$("#search").val("");
					$("#urlOrMagnet").val("");
					return false;
				});
			});
		})(jQuery);
	</script>
</div>